{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>Choose Your Game</h1>
    <p>Select a game and create a match to compete for real money!</p>
</div>

<div class="games-grid">
    {% for game in games %}
    <div class="game-card" onclick="selectGame('{{ game.id }}', '{{ game.name }}', {{ game.min_bet }}, {{ game.max_bet }})">
        <img src="{{ game.image }}" alt="{{ game.name }}" style="width: 100%; height: 120px; object-fit: contain; border-radius: 8px; margin-bottom: 1rem; background: rgba(255,255,255,0.1);">
        <h3>{{ game.name }}</h3>
        <p>Min: KSh {{ game.min_bet }} | Max: KSh {{ game.max_bet }}</p>
        <p style="color: #666; font-size: 0.9rem;">Your Balance: KSh {{ "%.0f"|format(session.balance) }}</p>
    </div>
    {% endfor %}
</div>

<!-- Create Match Modal -->
<div id="createModal" class="modal">
    <div class="modal-content">
        <h2>Create Match - <span id="selectedGame"></span></h2>
        
        <form method="POST" action="{{ url_for('create_match') }}">
            <input type="hidden" name="game" id="gameInput">
            
            <div class="form-group">
                <label>Bet Amount (KSh)</label>
                <input type="number" name="bet_amount" id="betAmount" class="form-control" step="0.01" required>
                <small id="betRange"></small>
            </div>
            
            <div class="form-group">
                <label>Game Mode</label>
                <select name="game_mode" id="gameMode" class="form-control" required>
                    <option value="">Select Mode</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button type="submit" class="btn">Create Match</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function selectGame(id, name, minBet, maxBet) {
    document.getElementById('selectedGame').textContent = name;
    document.getElementById('gameInput').value = id;
    document.getElementById('betAmount').min = minBet;
    document.getElementById('betAmount').max = Math.min(maxBet, {{ session.balance }});
    document.getElementById('betAmount').value = minBet;
    document.getElementById('betRange').textContent = `Min: KSh ${minBet} | Max: KSh ${Math.min(maxBet, {{ session.balance }})} | Your Balance: KSh {{ "%.0f"|format(session.balance) }}`;
    
    // Set game modes based on game type
    const modes = {
        'pubg_mobile': ['Solo', 'Duo', 'Squad'],
        'cod_mobile': ['Team Deathmatch', 'Battle Royale', 'Domination'],
        'fifa_mobile': ['Head to Head', 'VSA', 'Manager Mode'],
        'efootball': ['Online Match', 'Dream Team', 'Master League'],
        'pes': ['myClub', 'Local Match', 'Online Co-op']
    };
    
    const select = document.getElementById('gameMode');
    select.innerHTML = '<option value="">Select Mode</option>';
    modes[id]?.forEach(mode => {
        select.innerHTML += `<option value="${mode}">${mode}</option>`;
    });
    
    document.getElementById('createModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('createModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('createModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>
{% endblock %}