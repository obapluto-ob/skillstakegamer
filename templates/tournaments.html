{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>Tournaments</h1>
    <p>Join tournaments and win big prizes! 85% goes to winners.</p>
</div>

<!-- Active Tournaments -->
<div class="card">
    <h2>Active Tournaments</h2>
    {% if tournaments %}
        {% for tournament in tournaments %}
        <div class="match-card" style="border: 2px solid #ffc107;">
            <div class="match-header">
                <div><strong>{{ tournament[1] }}</strong> - {{ tournament[2].upper() }}</div>
                <span class="status-badge" style="background: #ffc107; color: black;">{{ tournament[6].upper() }}</span>
            </div>
            
            <div style="margin: 1rem 0;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div>
                        <strong>Entry Fee:</strong><br>
                        <span style="color: #ffc107; font-size: 1.2rem;">KSh {{ "%.0f"|format(tournament[3] or 0) }}</span>
                    </div>
                    <div>
                        <strong>Prize Pool:</strong><br>
                        <span style="color: #28a745; font-size: 1.2rem;">KSh {{ "%.0f"|format(tournament[5] or 0) }}</span>
                    </div>
                    <div>
                        <strong>Players:</strong><br>
                        <span style="font-size: 1.2rem;">{{ tournament[8] }}/{{ tournament[4] }}</span>
                    </div>
                    <div>
                        <strong>Status:</strong><br>
                        {% if tournament[6] == 'open' %}
                            <span style="color: #28a745;">🟢 Joining</span>
                        {% elif tournament[6] == 'full' %}
                            <span style="color: #ffc107;">🟡 Starting Soon</span>
                        {% elif tournament[6] == 'active' %}
                            <span style="color: #dc3545;">🔴 In Progress</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <small>Created: {{ tournament[7] }}</small>
                </div>
                <div>
                    {% if tournament[6] == 'open' and (tournament[3]|float or 0) <= session.balance %}
                        <a href="{{ url_for('tournament_details', tournament_id=tournament[0]) }}" 
                           class="btn btn-primary">View Details</a>
                        <a href="{{ url_for('join_tournament', tournament_id=tournament[0]) }}" 
                           class="btn btn-success">Quick Join</a>
                    {% elif tournament[6] == 'open' %}
                        <a href="{{ url_for('tournament_details', tournament_id=tournament[0]) }}" 
                           class="btn btn-secondary">View Details</a>
                        <span style="color: #dc3545;">Need KSh {{ tournament[3]|float or 0 }}</span>
                    {% elif tournament[6] == 'active' %}
                        <a href="{{ url_for('tournament_submit_result', tournament_id=tournament[0]) }}" 
                           class="btn btn-success">Submit Result</a>
                        <a href="{{ url_for('tournament_details', tournament_id=tournament[0]) }}" 
                           class="btn btn-primary">View Details</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>No active tournaments. Check back soon!</p>
    {% endif %}
</div>

<!-- Tournament Rules -->
<div class="card">
    <h2>Tournament Rules</h2>
    <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
        <ul style="margin: 0; padding-left: 1.5rem;">
            <li><strong>Entry Fee:</strong> Pay once to join tournament</li>
            <li><strong>Prize Distribution:</strong> Top 4 players share 85% of prize pool</li>
            <li><strong>Format:</strong> Single elimination bracket</li>
            <li><strong>Matches:</strong> Best of 1 game per round</li>
            <li><strong>Screenshots:</strong> Required with game mode visible</li>
            <li><strong>Time Limit:</strong> 30 minutes to submit results</li>
            <li><strong>No Shows:</strong> Automatic forfeit after 10 minutes</li>
            <li><strong>Disputes:</strong> Admin reviews all screenshots</li>
        </ul>
    </div>
</div>

<!-- My Tournament History -->
<div class="card">
    <h2>My Tournament History</h2>
    {% if my_tournaments %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.1);">
                        <th style="padding: 0.5rem; text-align: left;">Tournament</th>
                        <th style="padding: 0.5rem; text-align: left;">Entry Fee</th>
                        <th style="padding: 0.5rem; text-align: left;">Position</th>
                        <th style="padding: 0.5rem; text-align: left;">Prize Won</th>
                        <th style="padding: 0.5rem; text-align: left;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for history in my_tournaments %}
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 0.5rem;">{{ history[1] }}</td>
                        <td style="padding: 0.5rem;">KSh {{ "%.0f"|format(history[3] or 0) }}</td>
                        <td style="padding: 0.5rem;">
                            {% if history[4] == 1 %}🥇 1st
                            {% elif history[4] == 2 %}🥈 2nd  
                            {% elif history[4] == 3 %}🥉 3rd
                            {% elif history[4] <= 8 %}🏅 {{ history[4] }}th
                            {% else %}❌ Eliminated
                            {% endif %}
                        </td>
                        <td style="padding: 0.5rem; color: {% if (history[5]|float or 0) > 0 %}#28a745{% else %}#dc3545{% endif %};">
                            {% if (history[5]|float or 0) > 0 %}+KSh {{ "%.0f"|format(history[5]|float or 0) }}{% else %}-KSh {{ "%.0f"|format(history[3]|float or 0) }}{% endif %}
                        </td>
                        <td style="padding: 0.5rem; font-size: 0.8rem;">{{ history[6] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No tournament history yet. <a href="#tournaments">Join your first tournament!</a></p>
    {% endif %}
</div>
{% endblock %}